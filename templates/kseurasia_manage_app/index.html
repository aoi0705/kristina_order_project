{% extends "kseurasia_manage_app/base_dashboard.html" %}
{% load static %}

{% block title %}トップ | KS Eurasia{% endblock %}
{% block header %}トップ（オーダーデータ取り込み）{% endblock %}

{% block content %}
  <div class="grid" style="grid-template-columns: 1.4fr .8fr;">
    <!-- 取り込みカード -->
    <section class="card">
      <div class="card-header">
        <div>
          <div style="font-weight:700;">Excel取込</div>
          <div class="muted" style="font-size:12px;">対応：.xlsx / .xlsm（最大 30MB 程度）</div>
        </div>
      </div>
      <div class="card-body">
        <form method="post" action="/orders/import/" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="row">
            <div class="col">
              <label for="file">ファイル</label>
              <input id="file" name="file" type="file" accept=".xlsx,.xlsm" required>
              <div class="hint">YAMATO/ROYAL/NIPPONIKA は自動判定します</div>
            </div>
            <div class="col">
              <label for="sheet_name">シート名（任意）</label>
              <input id="sheet_name" name="sheet_name" type="text" placeholder="未指定時は先頭シート">
            </div>
          </div>
          <div style="margin-top:16px; display:flex; gap:10px;">
            <button class="btn btn-primary" type="submit">
              アップロードして取り込み
            </button>
            <a class="btn" href="/imports/">インポート記録を見る</a>
          </div>
        </form>
      </div>
    </section>
  </div>

  <script>
    // 取り込みフォーム送信時に共通オーバーレイを表示
    (function(){
      const form = document.querySelector('form[action="/orders/import/"]');
      if(!form) return;
      const submitBtn = form.querySelector('button[type="submit"]');
  
      form.addEventListener('submit', function(){
        if (submitBtn) submitBtn.disabled = true;
        if (window.AppOverlay) window.AppOverlay.show("ファイルを取り込み中です…");
        // このまま通常のフォームPOST遷移。応答が返るまでオーバーレイが出続けます。
      });
    })();
  </script>
{% endblock %}
